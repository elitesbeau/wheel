<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#000">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%231d1d1f' rx='20' width='100' height='100'/><text x='50' y='68' text-anchor='middle' font-size='50' font-family='Arial' fill='white'>M</text></svg>">
  <title>Market Elites</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://www.paypal.com/sdk/js?client-id=ASLWD4aMBqx01d34Vpt6Clq7PXvzQmB0yTWZU0LTQNxL4TsQOqu33iHXGJZlynRhfpnESGaPkTGK7AFe&currency=USD"></script>
  <style>
    *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
    :root{--bg:#f5f5f7;--card:#fff;--input:#f0f0f2;--text:#1d1d1f;--text2:#86868b;--text3:#aeaeb2;--border:#e5e5e7;--hero:#1d1d1f;--green:#34c759;--green-bg:rgba(52,199,89,.12);--red:#ff3b30;--red-bg:rgba(255,59,48,.12);--blue:#007aff;--blue-bg:rgba(0,122,255,.12);--orange:#ff9500;--orange-bg:rgba(255,149,0,.12);--purple:#af52de;--purple-bg:rgba(175,82,222,.12)}
    [data-theme=dark]{--bg:#000;--card:#1c1c1e;--input:#2c2c2e;--text:#fff;--text2:#98989f;--text3:#636366;--border:#38383a;--hero:#1c1c1e}
    body{font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:var(--bg);color:var(--text);min-height:100vh}
    .app{max-width:430px;margin:0 auto;padding:12px 0 90px}
    .hero{margin:0 16px 20px;background:var(--hero);border-radius:24px;padding:20px;position:relative;overflow:hidden}
    .hero::before{content:'';position:absolute;top:-80%;right:-20%;width:300px;height:300px;background:radial-gradient(circle,rgba(255,255,255,.08) 0%,transparent 70%)}
    .hero-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:32px;position:relative;z-index:1}
    .hero-left{display:flex;align-items:center;gap:10px}
    .icon-btn{width:40px;height:40px;background:rgba(255,255,255,.1);border:none;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center}
    .icon-btn:active{background:rgba(255,255,255,.2)}
    .icon-btn svg{width:20px;height:20px;stroke:#fff;stroke-width:1.75;fill:none}
    .avatar-btn{width:40px;height:40px;border-radius:50%;border:2px solid rgba(255,255,255,.3);background:linear-gradient(135deg,#f97316,#dc2626);display:flex;align-items:center;justify-content:center;cursor:pointer}
    .avatar-btn span{color:#fff;font-weight:700;font-size:14px}
    .status{display:flex;align-items:center;gap:6px;padding:6px 12px;background:rgba(255,255,255,.1);border-radius:20px;font-size:11px;font-weight:600;color:#fff}
    .status-dot{width:6px;height:6px;border-radius:50%;background:var(--red)}
    .status.ready .status-dot{background:var(--orange)}
    .status.live .status-dot{background:var(--green);animation:pulse 2s infinite}
    @keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
    .hero-balance{text-align:center;margin-bottom:32px;position:relative;z-index:1}
    .balance-label{color:rgba(255,255,255,.6);font-size:13px;margin-bottom:6px}
    .balance-amount{font-size:44px;font-weight:800;color:#fff}
    .balance-change{display:inline-flex;margin-top:8px;padding:5px 12px;background:var(--green-bg);border-radius:12px;font-size:13px;font-weight:600;color:var(--green)}
    .hero-actions{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;position:relative;z-index:1}
    .hero-btn{display:flex;flex-direction:column;align-items:center;gap:10px;background:none;border:none;cursor:pointer;padding:8px}
    .hero-btn-icon{width:52px;height:52px;border-radius:50%;border:1.5px solid rgba(255,255,255,.25);display:flex;align-items:center;justify-content:center}
    .hero-btn:active .hero-btn-icon{background:rgba(255,255,255,.1);transform:scale(.95)}
    .hero-btn-icon svg{width:22px;height:22px;stroke:#fff;stroke-width:2;fill:none}
    .hero-btn span{font-size:11px;font-weight:500;color:rgba(255,255,255,.85)}
    .quick-actions{display:flex;justify-content:space-around;padding:0 16px;margin-bottom:24px}
    .quick-btn{display:flex;flex-direction:column;align-items:center;gap:8px;background:none;border:none;cursor:pointer}
    .quick-btn:active{transform:scale(.95)}
    .quick-icon{width:52px;height:52px;border-radius:50%;display:flex;align-items:center;justify-content:center}
    .quick-icon svg{width:24px;height:24px;stroke-width:2;fill:none}
    .quick-icon.blue{background:var(--blue-bg)}.quick-icon.blue svg{stroke:var(--blue)}
    .quick-icon.green{background:var(--green-bg)}.quick-icon.green svg{stroke:var(--green)}
    .quick-icon.purple{background:var(--purple-bg)}.quick-icon.purple svg{stroke:var(--purple)}
    .quick-icon.orange{background:var(--orange-bg)}.quick-icon.orange svg{stroke:var(--orange)}
    .quick-btn span{font-size:12px;font-weight:500;color:var(--text2)}
    .section{padding:0 16px;margin-bottom:24px}
    .section-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    .section-title{font-size:18px;font-weight:700}
    .section-link{font-size:13px;font-weight:600;color:var(--blue);background:none;border:none;cursor:pointer}
    .pos-card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px;margin-bottom:12px;cursor:pointer}
    .pos-card:active{transform:scale(.98)}
    .pos-top{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:14px}
    .pos-left{display:flex;align-items:center;gap:12px}
    .pos-logo{width:44px;height:44px;border-radius:12px;background:var(--input);display:flex;align-items:center;justify-content:center;overflow:hidden}
    .pos-logo img{width:100%;height:100%;object-fit:cover}
    .pos-logo-text{font-size:14px;font-weight:700;color:var(--text2)}
    .pos-symbol{font-size:16px;font-weight:700}
    .pos-name{font-size:13px;color:var(--text2)}
    .pos-badge{padding:5px 10px;border-radius:8px;font-size:11px;font-weight:700}
    .pos-badge.csp{background:var(--green-bg);color:var(--green)}
    .pos-badge.cc{background:var(--blue-bg);color:var(--blue)}
    .pos-badge.shares{background:var(--purple-bg);color:var(--purple)}
    .pos-stats{display:flex;justify-content:space-between}
    .pos-stat-val{font-size:15px;font-weight:700}
    .pos-stat-val.pos{color:var(--green)}.pos-stat-val.neg{color:var(--red)}
    .pos-stat-label{font-size:11px;color:var(--text3);margin-top:2px}
    .tx-list{background:var(--card);border:1px solid var(--border);border-radius:16px;overflow:hidden}
    .tx-item{display:flex;align-items:center;gap:12px;padding:14px 16px;border-bottom:1px solid var(--border)}
    .tx-item:last-child{border-bottom:none}
    .tx-icon{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center}
    .tx-icon svg{width:18px;height:18px;stroke-width:2;fill:none}
    .tx-icon.csp{background:var(--green-bg)}.tx-icon.csp svg{stroke:var(--green)}
    .tx-icon.cc{background:var(--blue-bg)}.tx-icon.cc svg{stroke:var(--blue)}
    .tx-info{flex:1}.tx-title{font-size:15px;font-weight:600}.tx-sub{font-size:12px;color:var(--text3)}
    .tx-amount{font-size:15px;font-weight:700}
    .tx-amount.pos{color:var(--green)}.tx-amount.neg{color:var(--red)}
    .empty{text-align:center;padding:40px 20px;background:var(--card);border:1px solid var(--border);border-radius:16px}
    .empty-icon{width:56px;height:56px;margin:0 auto 12px;background:var(--input);border-radius:50%;display:flex;align-items:center;justify-content:center}
    .empty-icon svg{width:24px;height:24px;stroke:var(--text3);stroke-width:1.5;fill:none}
    .empty-title{font-size:16px;font-weight:600;margin-bottom:4px}
    .empty-text{font-size:13px;color:var(--text2);margin-bottom:16px}
    .empty-btn{padding:12px 24px;background:var(--hero);border:none;border-radius:12px;font-size:14px;font-weight:600;color:#fff;cursor:pointer}
    .nav{position:fixed;bottom:0;left:0;right:0;background:var(--card);border-top:1px solid var(--border);padding:8px 0 max(8px,env(safe-area-inset-bottom));z-index:100}
    .nav-inner{max-width:430px;margin:0 auto;display:flex;justify-content:space-around}
    .nav-btn{display:flex;flex-direction:column;align-items:center;gap:4px;padding:6px 12px;background:none;border:none;cursor:pointer}
    .nav-btn svg{width:24px;height:24px;stroke-width:1.75;fill:none}
    .nav-btn span{font-size:10px;font-weight:500}
    .nav-btn.active svg{stroke:var(--text)}.nav-btn.active span{color:var(--text);font-weight:600}
    .nav-btn:not(.active) svg{stroke:var(--text3)}.nav-btn:not(.active) span{color:var(--text3)}
    .tab{display:none}.tab.active{display:block}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:20px;margin:0 16px 16px}
    .card-title{font-size:12px;font-weight:600;color:var(--text2);text-transform:uppercase;letter-spacing:.5px;margin-bottom:16px}
    .form-group{margin-bottom:16px}
    .form-label{font-size:13px;font-weight:500;color:var(--text2);margin-bottom:8px;display:block}
    .form-input,.form-select{width:100%;background:var(--input);border:1px solid var(--border);border-radius:12px;padding:14px 16px;font-size:15px;color:var(--text);outline:none}
    .toggle{display:flex;background:var(--input);border-radius:10px;padding:4px;margin-bottom:16px}
    .toggle-btn{flex:1;padding:10px;border:none;border-radius:8px;font-size:13px;font-weight:600;cursor:pointer;background:transparent;color:var(--text2)}
    .toggle-btn.active{background:var(--card);color:var(--text);box-shadow:0 1px 3px rgba(0,0,0,.1)}
    .search-row{display:flex;gap:10px;margin-bottom:12px}
    .search-input{flex:1;background:var(--input);border:1px solid var(--border);border-radius:12px;padding:14px 16px;font-size:18px;font-weight:700;text-transform:uppercase;color:var(--text);outline:none}
    .search-btn{width:52px;height:52px;background:var(--hero);border:none;border-radius:12px;cursor:pointer;display:flex;align-items:center;justify-content:center}
    .search-btn svg{width:22px;height:22px;stroke:#fff;stroke-width:2.5;fill:none}
    .help-btn{width:32px;height:32px;background:var(--blue-bg);border:none;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center}
    .help-btn svg{width:16px;height:16px;stroke:var(--blue);stroke-width:2;fill:none}
    .tickers{display:flex;gap:8px;flex-wrap:wrap}
    .ticker-btn{padding:8px 14px;background:var(--input);border:1px solid var(--border);border-radius:20px;font-size:12px;font-weight:600;color:var(--text2);cursor:pointer}
    .ticker-btn:active{background:var(--hero);color:#fff}
    .stats-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .stat-box{background:var(--input);border-radius:12px;padding:16px;text-align:center}
    .stat-val{font-size:22px;font-weight:700}.stat-val.green{color:var(--green)}.stat-val.blue{color:var(--blue)}
    .stat-label{font-size:11px;color:var(--text2)}
    .btn{width:100%;padding:16px;background:var(--hero);border:none;border-radius:12px;font-size:15px;font-weight:600;color:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px}
    .btn svg{width:18px;height:18px;stroke:#fff;stroke-width:2;fill:none}
    .btn-outline{background:transparent;border:1.5px solid var(--border);color:var(--text)}.btn-outline svg{stroke:var(--text)}
    .btn-red{background:var(--red-bg);color:var(--red)}.btn-red svg{stroke:var(--red)}
    .modal-bg{position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:200;display:none;align-items:flex-end;justify-content:center}
    .modal-bg.show{display:flex}.modal-bg.center{align-items:center}
    .modal{background:var(--card);border-radius:20px 20px 0 0;padding:20px;padding-bottom:max(20px,env(safe-area-inset-bottom));width:100%;max-width:430px;max-height:85vh;overflow-y:auto;animation:slideUp .3s ease}
    .modal-bg.center .modal{border-radius:20px;margin:20px}
    @keyframes slideUp{from{transform:translateY(100%)}}
    .modal-handle{width:36px;height:4px;background:var(--border);border-radius:2px;margin:0 auto 16px}
    .modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
    .modal-title{font-size:18px;font-weight:700}
    .modal-close{width:32px;height:32px;background:var(--input);border:none;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center}
    .modal-close svg{width:16px;height:16px;stroke:var(--text2);stroke-width:2;fill:none}
    .setting-row{display:flex;justify-content:space-between;align-items:center;padding:14px 0;border-bottom:1px solid var(--border)}
    .setting-row:last-child{border-bottom:none}
    .switch{width:50px;height:28px;background:var(--input);border-radius:14px;padding:2px;border:none;cursor:pointer}
    .switch.on{background:var(--green)}
    .switch-knob{width:24px;height:24px;background:#fff;border-radius:50%;transition:transform .2s;box-shadow:0 1px 3px rgba(0,0,0,.2)}
    .switch.on .switch-knob{transform:translateX(22px)}
    .profile-header{text-align:center;padding:20px 0}
    .profile-avatar{width:100px;height:100px;border-radius:50%;margin:0 auto 16px;background:linear-gradient(135deg,#f97316,#dc2626);display:flex;align-items:center;justify-content:center;position:relative;cursor:pointer}
    .profile-avatar span{color:#fff;font-size:36px;font-weight:700}
    .profile-avatar-edit{position:absolute;bottom:0;right:0;width:32px;height:32px;background:var(--blue);border-radius:50%;display:flex;align-items:center;justify-content:center}
    .profile-avatar-edit svg{width:16px;height:16px;stroke:#fff;stroke-width:2;fill:none}
    .profile-name{font-size:24px;font-weight:700}
    .profile-email{font-size:14px;color:var(--text2);margin-bottom:16px}
    .profile-badge{display:inline-flex;padding:8px 16px;background:var(--text);border-radius:20px;font-size:13px;font-weight:600;color:var(--bg)}
    .profile-stats{display:flex;justify-content:space-around;padding:20px 0;border-top:1px solid var(--border);border-bottom:1px solid var(--border);margin:20px 0}
    .profile-stat{text-align:center}.profile-stat-val{font-size:20px;font-weight:700}.profile-stat-label{font-size:12px;color:var(--text2)}
    .signal-card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px;margin-bottom:12px;position:relative}
    .signal-card.locked::after{content:'';position:absolute;inset:0;background:var(--bg);opacity:.85;border-radius:16px}
    .signal-header{display:flex;justify-content:space-between;margin-bottom:12px}
    .signal-type{padding:4px 10px;border-radius:6px;font-size:11px;font-weight:700}
    .signal-type.csp{background:var(--green-bg);color:var(--green)}
    .signal-type.cc{background:var(--blue-bg);color:var(--blue)}
    .signal-time{font-size:12px;color:var(--text3)}
    .signal-ticker{font-size:20px;font-weight:700}
    .signal-details{font-size:14px;color:var(--text2);margin:4px 0 12px}
    .signal-lock{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:1}
    .signal-lock svg{width:24px;height:24px;stroke:var(--text3);stroke-width:1.5;margin-bottom:6px}
    .signal-lock span{font-weight:500;color:var(--text2);font-size:13px}
    .wheely-avatar{width:48px;height:48px;background:linear-gradient(145deg,#6366f1,#4f46e5);border-radius:14px;position:relative;display:flex;align-items:center;justify-content:center}
    .wheely-face{width:36px;height:20px;background:#fff;border-radius:6px;display:flex;align-items:center;justify-content:center;gap:10px}
    .wheely-eye{width:6px;height:8px;background:#4f46e5;border-radius:2px;animation:blink 3s infinite}
    @keyframes blink{0%,94%,100%{transform:scaleY(1)}96%{transform:scaleY(.1)}}
    .wheely-antenna{position:absolute;top:-6px;left:50%;transform:translateX(-50%);width:3px;height:8px;background:#6366f1;border-radius:2px}
    .wheely-antenna::after{content:'';position:absolute;top:-5px;left:50%;transform:translateX(-50%);width:8px;height:8px;background:#a5b4fc;border-radius:50%}
    .ai-header{display:flex;align-items:center;gap:12px;margin-bottom:20px}
    .ai-info h3{font-size:16px;font-weight:700}.ai-info p{font-size:12px;color:var(--text2)}
    .ai-messages{min-height:200px;max-height:300px;overflow-y:auto;margin-bottom:16px}
    .ai-msg{padding:12px;border-radius:12px;margin-bottom:8px;font-size:14px;line-height:1.5;max-width:85%}
    .ai-msg.user{background:var(--blue);color:#fff;margin-left:auto}
    .ai-msg.bot{background:var(--input)}
    .legal-content{font-size:13px;line-height:1.7;color:var(--text2);max-height:50vh;overflow-y:auto;margin-bottom:20px;padding:16px;background:var(--input);border-radius:12px}
    .legal-content h3{color:var(--text);margin:16px 0 8px;font-size:14px}
    .legal-content h3:first-child{margin-top:0}
    .legal-checkbox{display:flex;align-items:flex-start;gap:12px;margin-bottom:20px}
    .legal-checkbox input{width:20px;height:20px;margin-top:2px;accent-color:var(--blue)}
    .legal-checkbox label{font-size:13px;color:var(--text2)}
    .footer{padding:20px 16px;text-align:center;font-size:11px;color:var(--text3)}
    .footer a{color:var(--text2);margin:0 8px}
    .loading{display:flex;justify-content:center;padding:40px}
    .spinner{width:32px;height:32px;border:3px solid var(--border);border-top-color:var(--blue);border-radius:50%;animation:spin .8s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    .hidden{display:none!important}
    .mt-4{margin-top:16px}
    .live-dot{display:inline-block;width:8px;height:8px;background:var(--green);border-radius:50%;margin-right:6px;animation:pulse 2s infinite}
    .lesson-page{padding:16px}
    .lesson-back{display:flex;align-items:center;gap:8px;font-size:14px;font-weight:600;color:var(--blue);background:none;border:none;cursor:pointer;margin-bottom:16px}
    .lesson-back svg{width:18px;height:18px;stroke:var(--blue);stroke-width:2;fill:none}
    .lesson-hero{background:linear-gradient(135deg,var(--hero),#2d2d2f);border-radius:20px;padding:24px;margin-bottom:20px;color:#fff}
    .lesson-hero h1{font-size:24px;font-weight:700;margin-bottom:8px}
    .lesson-hero p{font-size:14px;opacity:.8}
    .lesson-progress{display:flex;gap:6px;margin-top:16px}
    .lesson-progress-dot{width:8px;height:8px;border-radius:50%;background:rgba(255,255,255,.3)}
    .lesson-progress-dot.done{background:var(--green)}
    .lesson-progress-dot.current{background:#fff}
    .lesson-video{width:100%;aspect-ratio:16/9;border-radius:16px;background:var(--input);margin-bottom:20px;overflow:hidden}
    .lesson-video iframe{width:100%;height:100%;border:none}
    .lesson-video-placeholder{width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;color:var(--text2)}
    .lesson-video-placeholder svg{width:48px;height:48px;stroke:var(--text3);stroke-width:1.5}
    .lesson-content{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:20px;margin-bottom:16px}
    .lesson-content h2{font-size:18px;font-weight:700;margin-bottom:12px}
    .lesson-content h3{font-size:16px;font-weight:600;margin:16px 0 8px;color:var(--text)}
    .lesson-content p{font-size:14px;line-height:1.7;color:var(--text2);margin-bottom:12px}
    .lesson-content ul,.lesson-content ol{font-size:14px;line-height:1.7;color:var(--text2);margin:12px 0;padding-left:20px}
    .lesson-content li{margin-bottom:8px}
    .lesson-tip{background:var(--blue-bg);border-radius:12px;padding:16px;margin:16px 0}
    .lesson-tip-title{font-size:13px;font-weight:700;color:var(--blue);margin-bottom:6px}
    .lesson-tip p{font-size:13px;color:var(--text);margin:0}
    .lesson-warning{background:var(--orange-bg);border-radius:12px;padding:16px;margin:16px 0}
    .lesson-warning-title{font-size:13px;font-weight:700;color:var(--orange);margin-bottom:6px}
    .lesson-warning p{font-size:13px;color:var(--text);margin:0}
    .lesson-example{background:var(--input);border-radius:12px;padding:16px;margin:16px 0}
    .lesson-example-title{font-size:13px;font-weight:700;color:var(--text);margin-bottom:8px}
    .lesson-example-content{font-size:14px;color:var(--text2)}
    .lesson-nav{display:flex;gap:12px;margin-top:20px}
    .lesson-nav button{flex:1}
    .course-list{display:flex;flex-direction:column;gap:12px}
    .course-card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:20px;cursor:pointer}
    .course-card:active{transform:scale(.98)}
    .course-header{display:flex;align-items:center;gap:14px;margin-bottom:12px}
    .course-icon{width:50px;height:50px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:24px}
    .course-icon.blue{background:var(--blue-bg)}
    .course-icon.green{background:var(--green-bg)}
    .course-icon.purple{background:var(--purple-bg)}
    .course-icon.orange{background:var(--orange-bg)}
    .course-info h3{font-size:16px;font-weight:700}
    .course-info p{font-size:13px;color:var(--text2)}
    .course-meta{display:flex;gap:16px;font-size:12px;color:var(--text3)}
    .course-progress-bar{height:4px;background:var(--input);border-radius:2px;margin-top:12px;overflow:hidden}
    .course-progress-fill{height:100%;background:var(--green);border-radius:2px}
    .notif-badge{position:absolute;top:-4px;right:-4px;min-width:18px;height:18px;background:var(--red);border-radius:9px;font-size:11px;font-weight:700;color:#fff;display:flex;align-items:center;justify-content:center;padding:0 5px}
    .notif-item{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:14px;margin-bottom:10px;display:flex;gap:12px;align-items:flex-start}
    .notif-item.unread{border-left:3px solid var(--blue)}
    .notif-icon{width:36px;height:36px;border-radius:10px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
    .notif-icon svg{width:18px;height:18px;stroke-width:2}
    .notif-content{flex:1}
    .notif-title{font-size:14px;font-weight:600;margin-bottom:2px}
    .notif-text{font-size:13px;color:var(--text2)}
    .notif-time{font-size:11px;color:var(--text3);margin-top:4px}
    .admin-panel{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:20px;margin-bottom:16px}
    .admin-panel-title{font-size:14px;font-weight:700;color:var(--orange);margin-bottom:16px;display:flex;align-items:center;gap:8px}
    .admin-panel-title svg{width:18px;height:18px;stroke:var(--orange);stroke-width:2}
    .signal-form{display:flex;flex-direction:column;gap:12px}
    .signal-form-row{display:flex;gap:10px}
    .signal-form-row>*{flex:1}
    .signal-form .form-input,.signal-form .form-select{padding:12px 14px;font-size:14px}
    .quick-signal-btns{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
    .quick-signal-btn{padding:8px 14px;background:var(--input);border:1px solid var(--border);border-radius:8px;font-size:13px;font-weight:500;cursor:pointer}
    .quick-signal-btn:hover{background:var(--hero);color:#fff}
    .signals-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
    .signal-tabs{display:flex;gap:8px}
    .signal-tab{padding:8px 16px;background:var(--input);border:none;border-radius:20px;font-size:13px;font-weight:500;cursor:pointer;color:var(--text2)}
    .signal-tab.active{background:var(--hero);color:#fff}
  </style>
</head>
<body>
  <div class="modal-bg center" id="legalModal">
    <div class="modal">
      <div class="modal-header"><span class="modal-title">Terms & Risk Disclosure</span></div>
      <div class="legal-content">
        <h3>‚ö†Ô∏è Risk Disclosure</h3>
        <p>Options trading involves substantial risk of loss. You could lose more than your initial investment.</p>
        <h3>üìã Not Financial Advice</h3>
        <p>Market Elites is for educational purposes only. Nothing herein constitutes investment advice.</p>
        <h3>üîê Data Privacy</h3>
        <p>Your data is stored locally. API keys are never transmitted to our servers.</p>
      </div>
      <div class="legal-checkbox">
        <input type="checkbox" id="legalAgree" onchange="document.getElementById('legalBtn').disabled=!this.checked">
        <label for="legalAgree">I understand the risks and agree to these terms.</label>
      </div>
      <button class="btn" id="legalBtn" onclick="acceptLegal()" disabled>Accept & Continue</button>
    </div>
  </div>

  <div class="app">
    <div class="tab active" id="homeTab">
      <div class="hero">
        <div class="hero-top">
          <div class="hero-left">
            <button class="icon-btn" onclick="openSettings()">
              <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
            </button>
            <button class="avatar-btn" onclick="nav('profile')"><span id="heroInitials">?</span></button>
          </div>
          <div class="status" id="statusPill"><span class="status-dot"></span><span id="statusText">Offline</span></div>
        </div>
        <div class="hero-balance">
          <div class="balance-label">Portfolio Value</div>
          <div class="balance-amount">$<span id="balanceVal">25,000</span></div>
          <div class="balance-change" id="balanceChange">‚Üë +$0 (0%)</div>
        </div>
        <div class="hero-actions">
          <button class="hero-btn" onclick="goCalc('csp')"><div class="hero-btn-icon"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 8v8M8 12l4 4 4-4"/></svg></div><span>Sell Put</span></button>
          <button class="hero-btn" onclick="openAdd()"><div class="hero-btn-icon"><svg viewBox="0 0 24 24"><path d="M12 5v14M5 12h14"/></svg></div><span>Add</span></button>
          <button class="hero-btn" onclick="goCalc('cc')"><div class="hero-btn-icon"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 16V8M8 12l4-4 4 4"/></svg></div><span>Sell Call</span></button>
          <button class="hero-btn" onclick="syncPositions()"><div class="hero-btn-icon"><svg viewBox="0 0 24 24"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 16h5v5"/></svg></div><span>Sync</span></button>
        </div>
      </div>
      <div class="quick-actions">
        <button class="quick-btn" onclick="openLearn()"><div class="quick-icon blue"><svg viewBox="0 0 24 24"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg></div><span>Learn</span></button>
        <button class="quick-btn" onclick="openAnalytics()"><div class="quick-icon green"><svg viewBox="0 0 24 24"><path d="M3 3v18h18"/><path d="m19 9-5 5-4-4-3 3"/></svg></div><span>Analytics</span></button>
        <button class="quick-btn" onclick="openAI()"><div class="quick-icon purple"><svg viewBox="0 0 24 24"><rect x="3" y="8" width="18" height="12" rx="2"/><path d="M7 8V6a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v2"/><circle cx="9" cy="14" r="1.5"/><circle cx="15" cy="14" r="1.5"/></svg></div><span>Wheely</span></button>
        <button class="quick-btn" onclick="nav('signals')"><div class="quick-icon orange"><svg viewBox="0 0 24 24"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg></div><span>Signals</span></button>
      </div>
      <div class="section" id="updatesSection" style="display:none"><div class="section-header"><span class="section-title">Recent Updates</span><button class="section-link" onclick="nav('signals');showSignalTab('notifs')">View All</button></div><div id="homeUpdatesContainer"></div></div>
      <div class="section"><div class="section-header"><span class="section-title">Active Positions</span></div><div id="positionsContainer"></div></div>
      <div class="section"><div class="section-header"><span class="section-title">Recent Trades</span></div><div id="historyContainer"></div></div>
      <div class="footer"><a href="#" onclick="openModal('legalModal')">Terms</a>‚Ä¢<a href="#">Privacy</a>‚Ä¢<a href="#">Disclaimer</a><p style="margin-top:8px">¬© 2025 Market Elites. Not financial advice.</p></div>
    </div>

    <div class="tab" id="calcTab">
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px"><span class="card-title" style="margin:0">Options Calculator</span><button class="help-btn" onclick="openLearn()"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg></button></div>
        <div class="toggle"><button class="toggle-btn active" id="cspBtn" onclick="setMode('csp')">Cash Secured Put</button><button class="toggle-btn" id="ccBtn" onclick="setMode('cc')">Covered Call</button></div>
        <div class="search-row"><input type="text" class="search-input" id="tickerInput" placeholder="AAPL" maxlength="5"><button class="search-btn" onclick="searchTicker()"><svg viewBox="0 0 24 24"><path d="M5 12h14M12 5l7 7-7 7"/></svg></button></div>
        <div class="tickers"><button class="ticker-btn" onclick="qSearch('AAPL')">AAPL</button><button class="ticker-btn" onclick="qSearch('NVDA')">NVDA</button><button class="ticker-btn" onclick="qSearch('TSLA')">TSLA</button><button class="ticker-btn" onclick="qSearch('SPY')">SPY</button></div>
      </div>
      <div class="card hidden" id="loadingCard"><div class="loading"><div class="spinner"></div></div></div>
      <div class="card hidden" id="stockCard"><div style="font-size:24px;font-weight:700" id="stockSymbol">AAPL</div><div style="font-size:13px;color:var(--text2)" id="stockName">Apple Inc.</div><div style="font-size:36px;font-weight:700;margin:8px 0">$<span id="stockPrice">0.00</span></div></div>
      <div class="card hidden" id="optCard"><div class="card-title">Select Contract</div><div class="form-group"><label class="form-label">Expiration</label><select class="form-select" id="expSelect" onchange="onExpChange()"><option>Select...</option></select></div><div class="form-group"><label class="form-label">Strike</label><select class="form-select" id="strikeSelect" onchange="onStrikeChange()"><option>Select...</option></select></div></div>
      <div class="card hidden" id="resultCard"><div class="card-title">Analysis</div><div class="stats-grid"><div class="stat-box"><div class="stat-val green">$<span id="resPrem">0</span></div><div class="stat-label">Premium</div></div><div class="stat-box"><div class="stat-val blue"><span id="resAnn">0</span>%</div><div class="stat-label">Annualized</div></div><div class="stat-box"><div class="stat-val"><span id="resProb">0</span>%</div><div class="stat-label">Prob. Profit</div></div><div class="stat-box"><div class="stat-val"><span id="resCon">1</span></div><div class="stat-label">Contracts</div></div></div><button class="btn mt-4" onclick="addFromCalc()"><svg viewBox="0 0 24 24"><path d="M12 5v14M5 12h14"/></svg>Add to Portfolio</button></div>
      <div class="card" id="emptyCalc"><div class="empty" style="background:transparent;border:none"><div class="empty-icon"><svg viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg></div><div class="empty-title">Search a Symbol</div><div class="empty-text">Enter a ticker to calculate</div><button class="btn btn-outline" style="width:auto;margin:0 auto" onclick="openLearn()">New? Learn the basics ‚Üí</button></div></div>
    </div>

    <div class="tab" id="watchTab"><div class="section" style="padding-top:16px"><div class="section-header"><span class="section-title">Watchlist</span><button class="section-link" onclick="refreshWatch()">‚Üª Refresh</button></div><div id="watchContainer"></div></div></div>

    <div class="tab" id="signalsTab">
      <div class="section" style="padding-top:16px">
        <div class="signals-header">
          <span class="section-title">Signals & Alerts</span>
          <div class="signal-tabs">
            <button class="signal-tab active" onclick="showSignalTab('signals')">Signals</button>
            <button class="signal-tab" onclick="showSignalTab('alerts')">Alerts</button>
            <button class="signal-tab" onclick="showSignalTab('notifs')">Updates</button>
          </div>
        </div>
        <div id="adminPanel" class="admin-panel hidden">
          <div class="admin-panel-title"><svg viewBox="0 0 24 24" fill="none"><path d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>Admin - Post Signal</div>
          <div class="quick-signal-btns">
            <button class="quick-signal-btn" onclick="quickFill('NVDA')">NVDA</button>
            <button class="quick-signal-btn" onclick="quickFill('AAPL')">AAPL</button>
            <button class="quick-signal-btn" onclick="quickFill('TSLA')">TSLA</button>
            <button class="quick-signal-btn" onclick="quickFill('AMD')">AMD</button>
            <button class="quick-signal-btn" onclick="quickFill('SPY')">SPY</button>
          </div>
          <div class="signal-form">
            <div class="signal-form-row">
              <select class="form-select" id="sigType"><option value="csp">CSP</option><option value="cc">CC</option></select>
              <input type="text" class="form-input" id="sigTicker" placeholder="TICKER" maxlength="5" style="text-transform:uppercase">
            </div>
            <div class="signal-form-row">
              <input type="number" class="form-input" id="sigStrike" placeholder="Strike">
              <input type="text" class="form-input" id="sigExp" placeholder="Jan 31">
            </div>
            <div class="signal-form-row">
              <input type="text" class="form-input" id="sigPrem" placeholder="$3.20">
              <input type="text" class="form-input" id="sigDelta" placeholder="0.25">
            </div>
            <textarea class="form-input" id="sigNotes" placeholder="Notes (optional)" rows="2" style="resize:none"></textarea>
            <button class="btn" onclick="postSignal()"><svg viewBox="0 0 24 24"><path d="m22 2-7 20-4-9-9-4Z"/></svg>Post Signal</button>
          </div>
        </div>
        <div id="signalsContent"><div id="signalsContainer"></div></div>
        <div id="alertsContent" class="hidden"><div id="alertsContainer"></div></div>
        <div id="notifsContent" class="hidden">
          <div id="announcementPanel" class="admin-panel hidden">
            <div class="admin-panel-title"><svg viewBox="0 0 24 24" fill="none"><path d="M19 4v6.4c0 .56 0 .84-.11 1.05a1 1 0 01-.44.44C18.24 12 17.96 12 17.4 12H6.6c-.56 0-.84 0-1.05-.11a1 1 0 01-.44-.44C5 11.24 5 10.96 5 10.4V4M19 4a2 2 0 00-2-2H7a2 2 0 00-2 2M19 4v0a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V6a2 2 0 012-2v0M12 16v-4m0 0l-2 2m2-2l2 2"/></svg>Send Announcement</div>
            <textarea class="form-input" id="announcementText" placeholder="Type your announcement message..." rows="3" style="resize:none;margin-bottom:12px"></textarea>
            <button class="btn" onclick="postAnnouncement()"><svg viewBox="0 0 24 24"><path d="m22 2-7 20-4-9-9-4Z"/></svg>Send to All Users</button>
          </div>
          <div id="notifsContainer"></div>
        </div>
      </div>
    </div>

    <div class="tab" id="profileTab">
      <div class="card">
        <div class="profile-header">
          <div class="profile-avatar"><span id="profileInitials">?</span><div class="profile-avatar-edit"><svg viewBox="0 0 24 24"><path d="M12 20h9"/><path d="M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"/></svg></div></div>
          <div class="profile-name" id="profileName">Set up your profile</div>
          <div class="profile-email" id="profileEmail">Tap to edit</div>
          <div class="profile-badge hidden" id="proBadge">Premium Member</div>
        </div>
        <div class="profile-stats">
          <div class="profile-stat"><div class="profile-stat-val" id="pTrades">0</div><div class="profile-stat-label">Trades</div></div>
          <div class="profile-stat"><div class="profile-stat-val" id="pWinRate">0%</div><div class="profile-stat-label">Win Rate</div></div>
          <div class="profile-stat"><div class="profile-stat-val" id="pPremium">$0</div><div class="profile-stat-label">Premium</div></div>
        </div>
      </div>
      <div class="card"><div class="card-title">Account</div><div class="form-group"><label class="form-label">Display Name</label><input type="text" class="form-input" id="userName" placeholder="Your name"></div><div class="form-group"><label class="form-label">Email</label><input type="email" class="form-input" id="userEmail" placeholder="email@example.com"></div><button class="btn btn-outline" onclick="saveProfile()">Save Profile</button></div>
      <div class="card"><div class="card-title">Brokerage</div><div id="brokerStatus"></div><div class="form-group"><label class="form-label">Alpaca API Key</label><input type="text" class="form-input" id="apiKeyInput" placeholder="PK..."></div><div class="form-group"><label class="form-label">Secret Key</label><input type="password" class="form-input" id="secretKeyInput" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div><div class="form-group"><label class="form-label">Account Size ($)</label><input type="number" class="form-input" id="accSizeInput" value="25000"></div><button class="btn" onclick="connectBroker()">Connect</button></div>
      <div class="card"><div class="card-title">Preferences</div><div class="setting-row"><span>Dark Mode</span><button class="switch" id="themeSwitch" onclick="toggleTheme()"><div class="switch-knob"></div></button></div><div class="setting-row"><span>Notifications</span><button class="switch" id="notifSwitch" onclick="toggleNotif()"><div class="switch-knob"></div></button></div><div class="setting-row"><span>Admin Access</span><button class="btn btn-outline" style="padding:8px 16px;width:auto" onclick="enableAdmin()" id="adminBtn">Enable</button></div></div>
      <div class="card" id="proCard"><div style="text-align:center"><div style="font-size:18px;font-weight:700;margin-bottom:8px">Upgrade to Premium</div><div style="font-size:13px;color:var(--text2);margin-bottom:20px">Unlock live signals & more</div><button class="btn" onclick="openPremium()">Get Premium ¬∑ $9.99/mo</button></div></div>
    </div>
  </div>

  <nav class="nav"><div class="nav-inner">
    <button class="nav-btn active" data-tab="home" onclick="nav('home')"><svg viewBox="0 0 24 24"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg><span>Home</span></button>
    <button class="nav-btn" data-tab="calc" onclick="nav('calc')"><svg viewBox="0 0 24 24"><rect x="4" y="2" width="16" height="20" rx="2"/><path d="M8 6h8M8 10h8M8 14h4"/></svg><span>Calc</span></button>
    <button class="nav-btn" data-tab="watch" onclick="nav('watch')"><svg viewBox="0 0 24 24"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg><span>Watch</span></button>
    <button class="nav-btn" data-tab="signals" onclick="nav('signals')" style="position:relative"><svg viewBox="0 0 24 24"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg><span>Signals</span><span class="notif-badge hidden" id="signalBadge">0</span></button>
    <button class="nav-btn" data-tab="profile" onclick="nav('profile')"><svg viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg><span>Profile</span></button>
  </div></nav>

  <div class="modal-bg" id="settingsModal" onclick="closeModal('settingsModal')"><div class="modal" onclick="event.stopPropagation()"><div class="modal-handle"></div><div class="modal-header"><span class="modal-title">Quick Settings</span><button class="modal-close" onclick="closeModal('settingsModal')"><svg viewBox="0 0 24 24"><path d="M18 6 6 18M6 6l12 12"/></svg></button></div>
    <div class="setting-row"><span>Dark Mode</span><button class="switch" id="qThemeSwitch" onclick="toggleTheme()"><div class="switch-knob"></div></button></div>
    <div class="setting-row"><span>Notifications</span><button class="switch" id="qNotifSwitch" onclick="toggleNotif()"><div class="switch-knob"></div></button></div>
    <div style="padding:16px 0;border-bottom:1px solid var(--border)"><div class="form-group" style="margin-bottom:12px"><label class="form-label">Alpaca API Key</label><input type="text" class="form-input" id="qApiKey" placeholder="PK..."></div><div class="form-group" style="margin-bottom:12px"><label class="form-label">Secret Key</label><input type="password" class="form-input" id="qSecretKey" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div><button class="btn btn-outline" onclick="quickSaveApi()">Save API Keys</button></div>
    <button class="btn btn-red mt-4" onclick="signOut()"><svg viewBox="0 0 24 24"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>Sign Out</button>
  </div></div>

  <div class="modal-bg" id="addModal" onclick="closeModal('addModal')"><div class="modal" onclick="event.stopPropagation()"><div class="modal-handle"></div><div class="modal-header"><span class="modal-title">Add Position</span><button class="modal-close" onclick="closeModal('addModal')"><svg viewBox="0 0 24 24"><path d="M18 6 6 18M6 6l12 12"/></svg></button></div><div class="toggle"><button class="toggle-btn active" id="addCspBtn" onclick="setAddMode('csp')">CSP</button><button class="toggle-btn" id="addCcBtn" onclick="setAddMode('cc')">CC</button><button class="toggle-btn" id="addSharesBtn" onclick="setAddMode('shares')">Shares</button></div><div class="form-group"><label class="form-label">Symbol</label><input type="text" class="form-input" id="addSymbol" placeholder="AAPL" style="text-transform:uppercase" maxlength="5"></div><div id="optFields"><div class="form-group"><label class="form-label">Strike</label><input type="number" class="form-input" id="addStrike" placeholder="150" step="0.5"></div><div class="form-group"><label class="form-label">Expiration</label><input type="date" class="form-input" id="addExp"></div><div class="form-group"><label class="form-label">Premium</label><input type="number" class="form-input" id="addPremium" placeholder="2.50" step="0.01"></div></div><div id="shareFields" class="hidden"><div class="form-group"><label class="form-label">Cost Basis</label><input type="number" class="form-input" id="addCost" placeholder="150" step="0.01"></div></div><div class="form-group"><label class="form-label">Contracts</label><input type="number" class="form-input" id="addContracts" value="1" min="1"></div><button class="btn" onclick="savePosition()">Add Position</button></div></div>

  <div class="modal-bg" id="learnModal" onclick="closeModal('learnModal')"><div class="modal" onclick="event.stopPropagation()" style="max-height:90vh"><div class="modal-handle"></div><div class="modal-header"><span class="modal-title" id="learnTitle">Courses</span><button class="modal-close" onclick="closeModal('learnModal')"><svg viewBox="0 0 24 24"><path d="M18 6 6 18M6 6l12 12"/></svg></button></div><div id="learnContent"></div></div></div>

  <div class="modal-bg" id="analyticsModal" onclick="closeModal('analyticsModal')"><div class="modal" onclick="event.stopPropagation()" style="max-height:90vh"><div class="modal-handle"></div><div class="modal-header"><span class="modal-title">Analytics</span><button class="modal-close" onclick="closeModal('analyticsModal')"><svg viewBox="0 0 24 24"><path d="M18 6 6 18M6 6l12 12"/></svg></button></div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px">
      <div style="background:var(--green-bg);border-radius:16px;padding:16px;text-align:center"><div style="font-size:12px;color:var(--green);font-weight:600">Total Premium</div><div style="font-size:28px;font-weight:700;color:var(--green)">$<span id="aPrem">0</span></div></div>
      <div style="background:var(--blue-bg);border-radius:16px;padding:16px;text-align:center"><div style="font-size:12px;color:var(--blue);font-weight:600">Total P&L</div><div style="font-size:28px;font-weight:700;color:var(--blue)">$<span id="aPnl">0</span></div></div>
    </div>
    <div style="background:var(--input);border-radius:16px;padding:16px;margin-bottom:16px">
      <div style="font-size:13px;font-weight:600;margin-bottom:12px">Performance</div>
      <div class="stats-grid">
        <div class="stat-box"><div class="stat-val" id="aWin">0%</div><div class="stat-label">Win Rate</div></div>
        <div class="stat-box"><div class="stat-val" id="aTrades">0</div><div class="stat-label">Closed Trades</div></div>
        <div class="stat-box"><div class="stat-val" id="aActive">0</div><div class="stat-label">Active</div></div>
        <div class="stat-box"><div class="stat-val" id="aRoi">0%</div><div class="stat-label">ROI</div></div>
      </div>
    </div>
    <div style="background:var(--input);border-radius:16px;padding:16px;margin-bottom:16px">
      <div style="font-size:13px;font-weight:600;margin-bottom:12px">Trade Breakdown</div>
      <div style="display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid var(--border)"><span style="font-size:13px;color:var(--text2)">Cash Secured Puts</span><span style="font-weight:600" id="aCsp">0</span></div>
      <div style="display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid var(--border)"><span style="font-size:13px;color:var(--text2)">Covered Calls</span><span style="font-weight:600" id="aCc">0</span></div>
      <div style="display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid var(--border)"><span style="font-size:13px;color:var(--text2)">Avg Premium/Trade</span><span style="font-weight:600;color:var(--green)" id="aAvg">$0</span></div>
      <div style="display:flex;justify-content:space-between;align-items:center;padding:10px 0"><span style="font-size:13px;color:var(--text2)">Best Trade</span><span style="font-weight:600;color:var(--green)" id="aBest">‚Äî</span></div>
    </div>
    <div style="background:var(--input);border-radius:16px;padding:16px">
      <div style="font-size:13px;font-weight:600;margin-bottom:12px">Top Tickers</div>
      <div id="aTopTickers" style="display:flex;flex-wrap:wrap;gap:8px"></div>
    </div>
  </div></div>

  <div class="modal-bg" id="aiModal" onclick="closeModal('aiModal')"><div class="modal" onclick="event.stopPropagation()"><div class="modal-handle"></div>
    <div class="ai-header">
      <div class="wheely-avatar"><div class="wheely-antenna"></div><div class="wheely-face"><div class="wheely-eye"></div><div class="wheely-eye"></div></div></div>
      <div class="ai-info"><h3>Wheely</h3><p>Your wheel strategy assistant</p></div>
    </div>
    <div class="ai-messages" id="aiMessages"></div>
    <div class="search-row"><input type="text" class="form-input" id="aiInput" placeholder="Ask Wheely..." style="flex:1" onkeydown="if(event.key==='Enter')sendAI()"><button class="search-btn" onclick="sendAI()" style="width:48px;height:48px"><svg viewBox="0 0 24 24"><path d="m22 2-7 20-4-9-9-4Z"/></svg></button></div>
  </div></div>

  <div class="modal-bg" id="posModal" onclick="closeModal('posModal')"><div class="modal" onclick="event.stopPropagation()"><div class="modal-handle"></div><div class="modal-header"><span class="modal-title" id="posTitle">Position</span><button class="modal-close" onclick="closeModal('posModal')"><svg viewBox="0 0 24 24"><path d="M18 6 6 18M6 6l12 12"/></svg></button></div><div id="posContent"></div><div style="display:flex;gap:12px;margin-top:20px"><button class="btn btn-red" style="flex:1" onclick="closePosition()">Close</button><button class="btn" style="flex:1" onclick="closeModal('posModal')">Done</button></div></div></div>

  <div class="modal-bg" id="premiumModal" onclick="closeModal('premiumModal')"><div class="modal" onclick="event.stopPropagation()"><div class="modal-handle"></div>
    <div style="text-align:center;padding:20px 0"><div style="font-size:28px;font-weight:700">Premium</div><div style="font-size:14px;color:var(--text2);margin-top:8px">Unlock the full experience</div></div>
    <div style="margin:20px 0">
      <div style="display:flex;align-items:center;gap:12px;padding:12px 0;border-bottom:1px solid var(--border)"><span style="color:var(--green)">‚úì</span><span>All trading signals unlocked</span></div>
      <div style="display:flex;align-items:center;gap:12px;padding:12px 0;border-bottom:1px solid var(--border)"><span style="color:var(--green)">‚úì</span><span>Priority alerts & notifications</span></div>
      <div style="display:flex;align-items:center;gap:12px;padding:12px 0;border-bottom:1px solid var(--border)"><span style="color:var(--green)">‚úì</span><span>Advanced analytics dashboard</span></div>
      <div style="display:flex;align-items:center;gap:12px;padding:12px 0"><span style="color:var(--green)">‚úì</span><span>Direct support from the team</span></div>
    </div>
    <div style="background:linear-gradient(135deg,var(--hero),#2d2d2f);border-radius:16px;padding:20px;margin-bottom:20px;text-align:center">
      <div style="font-size:32px;font-weight:700;color:#fff" id="premiumPrice">$9.99<span style="font-size:16px;font-weight:400;opacity:.7">/month</span></div>
      <div style="font-size:12px;color:rgba(255,255,255,.6);margin-top:4px">One-time payment ¬∑ Lifetime access</div>
    </div>
    <div style="display:flex;gap:10px;margin-bottom:16px">
      <input type="text" class="form-input" id="discountCode" placeholder="Discount code (optional)" style="flex:1;text-transform:uppercase">
      <button class="btn btn-outline" style="width:auto;padding:0 16px" onclick="applyDiscount()">Apply</button>
    </div>
    <div id="paypal-button-container" style="min-height:150px"></div>
    <p style="font-size:12px;color:var(--text3);text-align:center;margin-top:12px">Secure payment powered by PayPal</p>
  </div></div>

<script>
const S={theme:'light',mode:'csp',addMode:'csp',apiKey:'',secretKey:'',accSize:25000,positions:[],history:[],selPosId:null,user:{name:'',email:''},isPremium:false,legalOk:false,notifOn:false,isAdmin:false,signals:[],notifications:[],readNotifs:[],courseProgress:{basics:0,csp:0,cc:0,delta:0},currentCourse:null,currentLesson:0,emailSubmitted:false};
const names={AAPL:'Apple Inc.',NVDA:'NVIDIA',TSLA:'Tesla',MSFT:'Microsoft',AMD:'AMD',SPY:'S&P 500 ETF',QQQ:'Nasdaq ETF',AMZN:'Amazon',GOOGL:'Alphabet',META:'Meta'};
const domains={AAPL:'apple.com',NVDA:'nvidia.com',TSLA:'tesla.com',MSFT:'microsoft.com',AMD:'amd.com',SPY:'ssga.com',QQQ:'invesco.com',AMZN:'amazon.com',GOOGL:'google.com',META:'meta.com'};
const ADMIN_CODE='elite2025';
const EMAIL_WEBHOOK=''; // Add your Google Sheet webhook URL here
const PREMIUM_PRICE=9.99; // Base price in USD
const DISCOUNT_CODES={WHEEL50:50,ELITE25:25,VIP100:100,LAUNCH30:30}; // code: percent off
const defaultSignals=[{id:'s1',type:'csp',ticker:'NVDA',strike:130,exp:'Jan 24',prem:'$3.20',delta:'0.25',time:Date.now()-7200000,notes:'Strong support at $125'},{id:'s2',type:'cc',ticker:'AAPL',strike:260,exp:'Jan 31',prem:'$2.80',delta:'0.30',time:Date.now()-18000000,notes:'Earnings play'},{id:'s3',type:'csp',ticker:'AMD',strike:135,exp:'Feb 7',prem:'$4.50',delta:'0.28',time:Date.now()-86400000,notes:''}];
const $=id=>document.getElementById(id);
const show=el=>$(el)?.classList.remove('hidden');
const hide=el=>$(el)?.classList.add('hidden');
const logo=s=>`https://financialmodelingprep.com/image-stock/${s.toUpperCase()}.png`;
function load(){try{const d=localStorage.getItem('meV6');if(d)Object.assign(S,JSON.parse(d));if(!S.signals.length)S.signals=defaultSignals}catch(e){S.signals=defaultSignals}}
function save(){try{localStorage.setItem('meV6',JSON.stringify(S))}catch(e){}}
function checkLegal(){if(!S.legalOk)openModal('legalModal')}
function acceptLegal(){S.legalOk=true;save();closeModal('legalModal')}
function toggleTheme(){S.theme=S.theme==='light'?'dark':'light';applyTheme();save()}
function applyTheme(){document.documentElement.setAttribute('data-theme',S.theme);['themeSwitch','qThemeSwitch'].forEach(id=>$(id)?.classList.toggle('on',S.theme==='dark'))}
function nav(t){document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));document.querySelectorAll('.nav-btn').forEach(x=>x.classList.remove('active'));$(`${t}Tab`)?.classList.add('active');document.querySelector(`.nav-btn[data-tab="${t}"]`)?.classList.add('active');if(t==='home')renderHome();if(t==='watch')renderWatch();if(t==='signals'){renderSignals();renderAlerts();renderNotifs();updateSignalBadge();if(S.isAdmin)show('adminPanel');else hide('adminPanel')}if(t==='profile')renderProfile()}
function showSignalTab(tab){document.querySelectorAll('.signal-tab').forEach(t=>t.classList.remove('active'));document.querySelector(`.signal-tab[onclick*="${tab}"]`)?.classList.add('active');hide('signalsContent');hide('alertsContent');hide('notifsContent');hide('adminPanel');hide('announcementPanel');show(tab+'Content');if(S.isAdmin&&tab==='signals')show('adminPanel');if(S.isAdmin&&tab==='notifs')show('announcementPanel')}
function updateSignalBadge(){const unread=S.notifications.filter(n=>!S.readNotifs.includes(n.id)).length;const badge=$('signalBadge');if(unread>0){badge.textContent=unread;badge.classList.remove('hidden')}else{badge.classList.add('hidden')}}
function goCalc(m){nav('calc');setMode(m)}
function openModal(id){$(id)?.classList.add('show')}
function closeModal(id){$(id)?.classList.remove('show')}
function openSettings(){$('qApiKey').value=S.apiKey;$('qSecretKey').value=S.secretKey;applyTheme();openModal('settingsModal')}
function quickSaveApi(){S.apiKey=$('qApiKey').value.trim();S.secretKey=$('qSecretKey').value.trim();save();updateStatus();closeModal('settingsModal');if(S.apiKey)alert('API keys saved!')}
function signOut(){if(confirm('Sign out and clear all data?')){localStorage.removeItem('meV6');location.reload()}}
function openAdd(){setAddMode('csp');openModal('addModal')}
const courses={
  basics:{name:'Wheel Strategy Fundamentals',desc:'Master the complete wheel strategy from start to finish',level:'Beginner',icon:'üìö',color:'blue',lessons:[
    {title:'What is The Wheel?',video:'',content:`<h2>Welcome to The Wheel Strategy</h2><p>The Wheel is a systematic options strategy that generates consistent income by selling options on stocks you want to own. It's one of the most reliable ways to generate 15-30% annual returns.</p><h3>The Three Phases</h3><ol><li><b>Phase 1: Sell Cash-Secured Puts</b> - Get paid to potentially buy stocks at a discount</li><li><b>Phase 2: Own Shares</b> - If assigned, you now own shares at a reduced cost basis</li><li><b>Phase 3: Sell Covered Calls</b> - Generate income from your shares until called away</li></ol><div class="lesson-tip"><div class="lesson-tip-title">Pro Tip</div><p>Only wheel stocks you'd be happy to own long-term. This removes emotional decision-making.</p></div><h3>Why The Wheel Works</h3><p>Options pricing includes a "risk premium" - extra value for uncertainty. As a seller, you capture this premium consistently while time decay (theta) works in your favor every single day.</p><div class="lesson-example"><div class="lesson-example-title">Real Example</div><div class="lesson-example-content">Selling a $150 put on AAPL for $3.00 premium means you collect $300 per contract. If AAPL stays above $150, you keep the entire premium. If assigned, your effective purchase price is $147 ($150 - $3 premium).</div></div>`},
    {title:'Understanding Options Basics',video:'',content:`<h2>Options Fundamentals</h2><p>Before diving into the wheel, you need to understand the building blocks of options trading.</p><h3>What is an Option?</h3><p>An option is a contract giving the buyer the right (but not obligation) to buy or sell a stock at a specific price by a certain date.</p><h3>Puts vs Calls</h3><ul><li><b>PUT Option:</b> Right to SELL at strike price. Put sellers are bullish.</li><li><b>CALL Option:</b> Right to BUY at strike price. Call sellers are bearish/neutral.</li></ul><h3>Key Terms</h3><ul><li><b>Strike Price:</b> The price at which the option can be exercised</li><li><b>Expiration (DTE):</b> Days until the option expires</li><li><b>Premium:</b> The price paid/received for the option</li><li><b>Assignment:</b> When you're obligated to fulfill the contract</li></ul><div class="lesson-warning"><div class="lesson-warning-title">Important</div><p>Each option contract represents 100 shares. A $3.00 premium = $300 total.</p></div><h3>Intrinsic vs Extrinsic Value</h3><p><b>Intrinsic value</b> is the real value if exercised today. <b>Extrinsic value</b> (time value) is the extra premium for uncertainty - this is what we capture as sellers.</p>`},
    {title:'Selecting the Right Stocks',video:'',content:`<h2>Stock Selection Criteria</h2><p>The stocks you choose to wheel determine your success. Here's the complete criteria for selecting wheel candidates.</p><h3>Must-Have Criteria</h3><ol><li><b>Stocks you want to own</b> - Only wheel companies you believe in long-term</li><li><b>Liquid options</b> - Tight bid-ask spreads (under $0.10 ideally)</li><li><b>Stock price fits your account</b> - Need 100x strike price in cash for CSPs</li><li><b>No upcoming binary events</b> - Avoid earnings, FDA decisions, etc.</li></ol><h3>Ideal Characteristics</h3><ul><li>Large-cap stocks ($10B+ market cap)</li><li>Moderate implied volatility (25-50%)</li><li>Strong fundamentals and profitability</li><li>Clear support/resistance levels</li></ul><div class="lesson-tip"><div class="lesson-tip-title">Starter Watchlist</div><p>AAPL, NVDA, AMD, MSFT, GOOGL, AMZN, SPY, QQQ - All have liquid options and are quality companies.</p></div><h3>Account Size Considerations</h3><p>With a $25,000 account, focus on stocks under $250/share. This lets you sell 1 put while maintaining diversification across 2-3 positions.</p>`},
    {title:'Your First Wheel Trade',video:'',content:`<h2>Executing Your First Trade</h2><p>Let's walk through a complete wheel trade from start to finish.</p><h3>Step 1: Select Your Stock</h3><p>Choose a stock from your watchlist. For this example, we'll use AAPL trading at $250.</p><h3>Step 2: Sell a Cash-Secured Put</h3><ol><li>Find a strike 5-10% below current price ($225-$237)</li><li>Select 30-45 DTE expiration</li><li>Look for 0.20-0.30 delta</li><li>Sell to open the put contract</li></ol><div class="lesson-example"><div class="lesson-example-title">Example Trade</div><div class="lesson-example-content">Sell AAPL $240 Put, 35 DTE, for $4.50 premium ($450 collected). Delta: 0.25. Margin required: $24,000.</div></div><h3>Step 3: Manage the Position</h3><ul><li><b>If expires worthless:</b> Keep $450, sell another put</li><li><b>If assigned:</b> You now own 100 AAPL at $235.50 effective cost ($240 - $4.50)</li></ul><h3>Step 4: Sell Covered Calls (if assigned)</h3><p>Once you own shares, sell calls above your cost basis to generate more income while waiting for shares to be called away.</p>`}
  ]},
  csp:{name:'Cash-Secured Puts Mastery',desc:'Advanced techniques for selling puts profitably',level:'Intermediate',icon:'üìâ',color:'green',lessons:[
    {title:'CSP Mechanics Deep Dive',video:'',content:`<h2>How Cash-Secured Puts Work</h2><p>A Cash-Secured Put (CSP) is when you sell a put option while having enough cash to buy 100 shares if assigned.</p><h3>The CSP Formula</h3><p><b>Cash Required = Strike Price √ó 100</b></p><p>Selling a $150 put requires $15,000 cash secured in your account.</p><h3>Profit Scenarios</h3><ol><li><b>Stock stays above strike:</b> Option expires worthless, keep 100% of premium</li><li><b>Stock drops but above strike at expiration:</b> Still keep premium</li><li><b>Stock below strike at expiration:</b> Assigned shares at strike price</li></ol><div class="lesson-tip"><div class="lesson-tip-title">The Edge</div><p>You keep premium in ALL scenarios. Assignment isn't a loss - you wanted to buy the stock anyway, now at a discount!</p></div><h3>Calculating Returns</h3><p><b>Return on Capital = (Premium / Strike) √ó (365 / DTE)</b></p><div class="lesson-example"><div class="lesson-example-title">Example</div><div class="lesson-example-content">$4.50 premium on $150 strike, 30 DTE = (4.50/150) √ó (365/30) = 36.5% annualized return</div></div>`},
    {title:'Strike Selection Strategy',video:'',content:`<h2>Choosing the Perfect Strike</h2><p>Strike selection is the most important decision in CSP trading. Here's how to do it systematically.</p><h3>The Delta Method</h3><p>Delta represents the probability of the option expiring in-the-money (ITM).</p><ul><li><b>0.30 Delta:</b> ~70% win rate, higher premium</li><li><b>0.25 Delta:</b> ~75% win rate, balanced approach</li><li><b>0.20 Delta:</b> ~80% win rate, lower premium but safer</li><li><b>0.15 Delta:</b> ~85% win rate, very conservative</li></ul><div class="lesson-tip"><div class="lesson-tip-title">Sweet Spot</div><p>Target 0.20-0.30 delta for optimal risk/reward. This gives you a cushion while still collecting meaningful premium.</p></div><h3>Technical Analysis Support</h3><p>Combine delta with chart analysis:</p><ul><li>Identify strong support levels</li><li>Sell puts AT or BELOW support</li><li>Use moving averages (50, 200 day) as guides</li></ul><h3>The 2-Strike Rule</h3><p>Always stay at least 2 strikes below the current price for a safety buffer during volatile markets.</p>`},
    {title:'Managing CSP Positions',video:'',content:`<h2>Position Management</h2><p>Knowing when to hold, roll, or close your CSPs is crucial for long-term success.</p><h3>The 50% Rule</h3><p>Close positions when you've captured 50% of max profit. This frees up capital for new trades and reduces risk.</p><div class="lesson-example"><div class="lesson-example-title">Example</div><div class="lesson-example-content">Sold put for $4.00. When it's worth $2.00, buy to close and take your $200 profit. Don't wait for the last $2.00.</div></div><h3>Rolling Techniques</h3><p><b>Rolling</b> means closing your current position and opening a new one, usually for a credit.</p><ul><li><b>Roll Out:</b> Same strike, later expiration (when stock is near strike)</li><li><b>Roll Out and Down:</b> Lower strike, later expiration (when stock breaks below)</li></ul><div class="lesson-warning"><div class="lesson-warning-title">Golden Rule</div><p>Only roll for a NET CREDIT. If you can't get a credit, take the assignment or close for a loss.</p></div><h3>When to Take Assignment</h3><p>If you still want to own the stock and the fundamentals haven't changed, assignment is fine! You're buying at your target price minus premium collected.</p>`},
    {title:'CSP Income Optimization',video:'',content:`<h2>Maximizing Your Returns</h2><p>Advanced techniques to squeeze more profit from your CSP strategy.</p><h3>Timing Your Entries</h3><ul><li><b>Sell on red days:</b> IV spikes when stocks drop, increasing premiums</li><li><b>Avoid Mondays:</b> Weekend theta decay already priced in</li><li><b>Thursdays/Fridays:</b> Often best premium for weekly options</li></ul><h3>IV Rank Strategy</h3><p>IV Rank shows current implied volatility vs. the past year.</p><ul><li><b>IV Rank > 30:</b> Good time to sell premium</li><li><b>IV Rank > 50:</b> Excellent opportunities</li><li><b>IV Rank < 20:</b> Consider waiting for better setups</li></ul><div class="lesson-tip"><div class="lesson-tip-title">Earnings Play</div><p>IV expands before earnings. Sell puts 2-3 weeks before earnings to capture elevated premium, then close before the announcement.</p></div><h3>Portfolio Allocation</h3><p>Never allocate more than 50% of your account to CSPs. Keep cash for opportunities and margin of safety.</p>`}
  ]},
  cc:{name:'Covered Calls Blueprint',desc:'Generate consistent income from your stock holdings',level:'Intermediate',icon:'üìà',color:'purple',lessons:[
    {title:'Covered Call Fundamentals',video:'',content:`<h2>Introduction to Covered Calls</h2><p>A Covered Call involves selling call options against shares you already own. It's one of the safest option strategies.</p><h3>The Setup</h3><ul><li>Own 100 shares of stock</li><li>Sell 1 call option against those shares</li><li>Collect premium immediately</li></ul><h3>Outcomes</h3><ol><li><b>Stock stays below strike:</b> Keep shares + keep premium</li><li><b>Stock rises above strike:</b> Shares called away at strike + keep premium</li><li><b>Stock drops:</b> Keep shares + premium (premium offsets some loss)</li></ol><div class="lesson-example"><div class="lesson-example-title">Example</div><div class="lesson-example-content">Own 100 NVDA at $140. Sell $150 call for $3.50. If NVDA stays under $150, keep $350. If above, sell shares at $150 + keep $350 = $153.50 effective sale price.</div></div><div class="lesson-tip"><div class="lesson-tip-title">Key Insight</div><p>Covered calls turn volatile stocks into income generators. You're trading upside potential for guaranteed income.</p></div>`},
    {title:'Strike Selection for Calls',video:'',content:`<h2>Choosing Your Call Strike</h2><p>The strike you choose determines your risk/reward profile.</p><h3>Strike Strategies</h3><ul><li><b>ATM (At-The-Money):</b> Highest premium, likely to be called away</li><li><b>OTM (Out-of-The-Money):</b> Lower premium, more upside potential</li><li><b>Deep OTM:</b> Lowest premium, unlikely to be called</li></ul><h3>The Cost Basis Rule</h3><p><b>Never sell calls below your cost basis unless you want to exit.</b></p><div class="lesson-warning"><div class="lesson-warning-title">Critical Rule</div><p>If you bought at $150, don't sell $145 calls. You'd lock in a loss if assigned.</p></div><h3>Delta Guidelines for Calls</h3><ul><li><b>0.30 Delta:</b> Aggressive, higher premium</li><li><b>0.20 Delta:</b> Balanced approach</li><li><b>0.10-0.15 Delta:</b> Conservative, keep most upside</li></ul><h3>Target: 1-2% Monthly</h3><p>Aim to collect 1-2% of your stock value monthly. On a $15,000 position, that's $150-$300/month.</p>`},
    {title:'Managing Covered Calls',video:'',content:`<h2>Position Management</h2><p>Active management dramatically improves covered call returns.</p><h3>The Buy-to-Close Strategy</h3><p>When your call has lost 50-80% of its value, buy it back and sell a new one.</p><div class="lesson-example"><div class="lesson-example-title">Example</div><div class="lesson-example-content">Sold call for $3.00. Now worth $0.60 (80% profit). Buy to close for $0.60, immediately sell new call for $2.50. You've locked in $2.40 and started fresh.</div></div><h3>Rolling Covered Calls</h3><ul><li><b>Roll Up:</b> Higher strike, same/later expiration (stock rising)</li><li><b>Roll Out:</b> Same strike, later expiration (need more time)</li><li><b>Roll Up and Out:</b> Higher strike + later expiration (aggressive uptrend)</li></ul><div class="lesson-tip"><div class="lesson-tip-title">Rolling Rule</div><p>Roll for a credit when possible. If stock has surged past your strike, sometimes it's best to let shares go and restart the wheel.</p></div><h3>Handling Assignment</h3><p>Being called away isn't bad! You sold at your target price + collected premium. Start selling CSPs again to re-enter.</p>`},
    {title:'Advanced CC Strategies',video:'',content:`<h2>Level Up Your Covered Calls</h2><p>Advanced techniques used by professional traders.</p><h3>The Wheel Integration</h3><p>Covered calls are phase 3 of the wheel. After assignment from a CSP:</p><ol><li>Calculate your adjusted cost basis (strike - premium received)</li><li>Sell calls ABOVE this adjusted cost basis</li><li>Continue until called away, then restart with CSPs</li></ol><h3>Dividend Capture Strategy</h3><p>For dividend stocks:</p><ul><li>Sell calls AFTER ex-dividend date</li><li>Avoid selling calls right before dividends (early assignment risk)</li><li>Use dividends to further reduce cost basis</li></ul><div class="lesson-tip"><div class="lesson-tip-title">Example</div><p>AAPL cost basis $175. Received $2.00 from CSP, $1.50 from CC, $0.96 dividend. True cost: $170.54. Sell calls above this!</p></div><h3>Scaling Strategies</h3><p>With 200+ shares, you can sell calls at different strikes and expirations to diversify your income and manage risk better.</p>`}
  ]},
  delta:{name:'Delta & Greeks Mastery',desc:'Advanced options math for better trade selection',level:'Advanced',icon:'üéØ',color:'orange',lessons:[
    {title:'Understanding Delta',video:'',content:`<h2>Delta: The Foundation</h2><p>Delta is the most important Greek for wheel traders. Master it and your win rate will soar.</p><h3>What Delta Tells You</h3><ul><li><b>Probability approximation:</b> 0.30 delta ‚âà 30% chance of expiring ITM</li><li><b>Price sensitivity:</b> How much option price changes per $1 stock move</li><li><b>Hedge ratio:</b> How many shares the option represents</li></ul><h3>Delta Values</h3><ul><li><b>Puts:</b> Negative delta (-0.30 means 30% ITM probability)</li><li><b>Calls:</b> Positive delta (+0.30 means 30% ITM probability)</li><li><b>ATM options:</b> ~0.50 delta</li><li><b>Deep ITM:</b> Approaching 1.00</li><li><b>Deep OTM:</b> Approaching 0.00</li></ul><div class="lesson-tip"><div class="lesson-tip-title">The Sweet Spot</div><p>For the wheel, target 0.20-0.30 delta. This gives you 70-80% win rate while still collecting meaningful premium.</p></div><h3>Delta Changes (Gamma)</h3><p>Delta isn't static. As stock price moves and time passes, delta changes. This is called Gamma.</p>`},
    {title:'Theta: Time Decay',video:'',content:`<h2>Theta: Your Best Friend</h2><p>As option sellers, theta (time decay) is our primary profit engine.</p><h3>How Theta Works</h3><p>Every day, options lose value due to time decay. This is theta. As sellers, we collect this decay as profit.</p><ul><li>Theta is expressed as daily value loss</li><li>A -0.05 theta means the option loses $5/day per contract</li><li>Theta accelerates as expiration approaches</li></ul><div class="lesson-example"><div class="lesson-example-title">Example</div><div class="lesson-example-content">You sold a put for $3.00 with theta of -0.08. Each day, all else equal, that option loses $8. Over 30 days, that's $240 of your $300 premium from theta alone.</div></div><h3>Theta Decay Curve</h3><p>Theta decay is NOT linear:</p><ul><li><b>45+ DTE:</b> Slow decay</li><li><b>21-45 DTE:</b> Moderate decay (sweet spot for selling)</li><li><b>0-21 DTE:</b> Rapid decay (but more gamma risk)</li></ul><div class="lesson-tip"><div class="lesson-tip-title">Strategy</div><p>Sell options at 30-45 DTE, close at 50% profit or 14-21 DTE. This captures the best theta without excessive gamma risk.</p></div>`},
    {title:'Implied Volatility',video:'',content:`<h2>IV: Pricing Your Edge</h2><p>Implied Volatility (IV) represents the market's expectation of future movement. Higher IV = higher premiums.</p><h3>IV Rank vs IV Percentile</h3><ul><li><b>IV Rank:</b> Current IV vs. high/low of past year (0-100)</li><li><b>IV Percentile:</b> % of days with lower IV than today</li></ul><h3>When to Sell Premium</h3><ul><li><b>IV Rank > 50:</b> Excellent time to sell</li><li><b>IV Rank 30-50:</b> Good opportunities</li><li><b>IV Rank < 30:</b> Premiums may be too low</li></ul><div class="lesson-warning"><div class="lesson-warning-title">IV Crush</div><p>After earnings or events, IV drops rapidly. Don't hold short options through binary events unless you're prepared for big moves.</p></div><h3>Vega: IV Sensitivity</h3><p>Vega measures how much option price changes with 1% IV change. As sellers, we benefit when IV drops (vega works against us when IV rises).</p><div class="lesson-tip"><div class="lesson-tip-title">Strategy</div><p>Sell premium when IV is high, and you'll profit both from theta decay AND IV contraction.</p></div>`},
    {title:'Greeks in Practice',video:'',content:`<h2>Putting It All Together</h2><p>Here's how to use the Greeks for better trade decisions.</p><h3>The Ideal CSP Setup</h3><ul><li><b>Delta:</b> -0.20 to -0.30</li><li><b>Theta:</b> High relative to delta</li><li><b>DTE:</b> 30-45 days</li><li><b>IV Rank:</b> > 30</li></ul><h3>Position Sizing with Delta</h3><p>Use delta to manage portfolio risk:</p><ul><li>Sum all your position deltas</li><li>Keep total portfolio delta reasonable</li><li>A -100 delta portfolio acts like short 100 shares</li></ul><div class="lesson-example"><div class="lesson-example-title">Portfolio Example</div><div class="lesson-example-content">3 CSPs: AAPL (-25 delta) + NVDA (-30 delta) + AMD (-25 delta) = -80 total delta. Your portfolio will lose ~$80 for every $1 the market drops.</div></div><h3>Greek-Based Adjustments</h3><ul><li><b>Delta increasing (stock dropping):</b> Consider rolling down</li><li><b>Theta slowing (approaching expiration):</b> Consider closing early</li><li><b>IV spiking:</b> Hold position - you sold high IV</li></ul><div class="lesson-tip"><div class="lesson-tip-title">Master Formula</div><p>High Theta + Low Delta + High IV = Optimal premium selling opportunity</p></div>`}
  ]}
};
function openLearn(){S.currentCourse=null;S.currentLesson=0;$('learnTitle').textContent='Courses';$('learnContent').innerHTML='<div class="course-list">'+Object.entries(courses).map(([id,c])=>{const progress=S.courseProgress[id]||0;const total=c.lessons.length;const pct=Math.round((progress/total)*100);return`<div class="course-card" onclick="openCourse('${id}')"><div class="course-header"><div class="course-icon ${c.color}">${c.icon}</div><div class="course-info"><h3>${c.name}</h3><p>${c.desc}</p></div></div><div class="course-meta"><span>${total} lessons</span><span>${c.level}</span><span>${pct}% complete</span></div><div class="course-progress-bar"><div class="course-progress-fill" style="width:${pct}%"></div></div></div>`}).join('')+'</div>';openModal('learnModal')}
function openCourse(id){S.currentCourse=id;S.currentLesson=0;showLessonContent()}
function showLessonContent(){const c=courses[S.currentCourse];const lesson=c.lessons[S.currentLesson];const progress=S.courseProgress[S.currentCourse]||0;$('learnTitle').textContent=c.name;$('learnContent').innerHTML=`<button class="lesson-back" onclick="openLearn()"><svg viewBox="0 0 24 24"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>All Courses</button><div class="lesson-hero"><h1>${lesson.title}</h1><p>Lesson ${S.currentLesson+1} of ${c.lessons.length}</p><div class="lesson-progress">${c.lessons.map((_,i)=>`<div class="lesson-progress-dot ${i<progress?'done':''} ${i===S.currentLesson?'current':''}"></div>`).join('')}</div></div>${lesson.video?`<div class="lesson-video"><iframe src="${lesson.video}" allowfullscreen></iframe></div>`:'<div class="lesson-video"><div class="lesson-video-placeholder"><svg viewBox="0 0 24 24" fill="none"><polygon points="5 3 19 12 5 21 5 3"/></svg><span>Video coming soon</span></div></div>'}<div class="lesson-content">${lesson.content}</div><div class="lesson-nav">${S.currentLesson>0?'<button class="btn btn-outline" onclick="prevLesson()">‚Üê Previous</button>':'<div></div>'}<button class="btn" onclick="nextLesson()">${S.currentLesson<c.lessons.length-1?'Next Lesson ‚Üí':'Complete Course ‚úì'}</button></div>`}
function prevLesson(){if(S.currentLesson>0){S.currentLesson--;showLessonContent()}}
function nextLesson(){const c=courses[S.currentCourse];if(S.currentLesson<c.lessons.length-1){S.currentLesson++;if(S.currentLesson>=(S.courseProgress[S.currentCourse]||0)){S.courseProgress[S.currentCourse]=S.currentLesson}save();showLessonContent()}else{S.courseProgress[S.currentCourse]=c.lessons.length;save();alert('Congratulations! Course completed!');openLearn()}}
function showLesson(id){openCourse(id)}
function openAnalytics(){
  const activePrem=S.positions.reduce((s,p)=>s+(p.premium||0)*(p.contracts||1)*100,0);
  const histPrem=S.history.reduce((s,t)=>s+(t.premium||0)*(t.contracts||1)*100,0);
  const totalPrem=activePrem+histPrem;
  const totalPnl=S.history.reduce((s,t)=>s+(t.pnl||0),0);
  const wins=S.history.filter(t=>(t.pnl||0)>=0).length;
  const total=S.history.length;
  const active=S.positions.length;
  const roi=S.accSize>0?((totalPnl/S.accSize)*100).toFixed(1):0;
  const cspCount=[...S.positions,...S.history].filter(t=>t.type==='csp').length;
  const ccCount=[...S.positions,...S.history].filter(t=>t.type==='cc').length;
  const allTrades=[...S.positions,...S.history].filter(t=>t.premium);
  const avgPrem=allTrades.length>0?(totalPrem/allTrades.length).toFixed(0):0;
  const bestTrade=S.history.length?S.history.reduce((best,t)=>(t.pnl||0)>(best.pnl||0)?t:best,S.history[0]):null;
  const tickers=[...S.positions,...S.history].reduce((acc,t)=>{acc[t.symbol]=(acc[t.symbol]||0)+1;return acc},{});
  const topTickers=Object.entries(tickers).sort((a,b)=>b[1]-a[1]).slice(0,5);
  $('aPrem').textContent=totalPrem.toFixed(0);
  $('aPnl').textContent=(totalPnl>=0?'':'-')+Math.abs(totalPnl).toFixed(0);
  $('aWin').textContent=total>0?Math.round(wins/total*100)+'%':'0%';
  $('aTrades').textContent=total;
  $('aActive').textContent=active;
  $('aRoi').textContent=roi+'%';
  $('aCsp').textContent=cspCount;
  $('aCc').textContent=ccCount;
  $('aAvg').textContent='$'+avgPrem;
  $('aBest').textContent=bestTrade?bestTrade.symbol+' +$'+(bestTrade.pnl||0).toFixed(0):'‚Äî';
  $('aTopTickers').innerHTML=topTickers.length?topTickers.map(([sym,cnt])=>`<span style="padding:6px 12px;background:var(--card);border:1px solid var(--border);border-radius:8px;font-size:12px;font-weight:600">${sym} <span style="color:var(--text3)">${cnt}</span></span>`).join(''):'<span style="color:var(--text3);font-size:13px">No trades yet</span>';
  openModal('analyticsModal')}
function openAI(){if(!$('aiMessages').innerHTML)$('aiMessages').innerHTML='<div class="ai-msg bot">Hey! I\'m <b>Wheely</b> ü§ñ Ask me about delta, DTE, rolling, or position sizing!</div>';openModal('aiModal')}
function sendAI(){const i=$('aiInput'),m=i.value.trim();if(!m)return;$('aiMessages').innerHTML+=`<div class="ai-msg user">${m}</div>`;i.value='';setTimeout(()=>{const l=m.toLowerCase();let r='The wheel: sell CSPs until assigned, then sell CCs. Target 0.20-0.30 delta, 30-45 DTE.';if(l.includes('delta'))r='<b>Delta:</b> Target 0.20-0.30 for CSPs. 70-80% win rate.';else if(l.includes('dte')||l.includes('expir'))r='<b>DTE:</b> 30-45 days optimal for theta decay.';else if(l.includes('roll'))r='<b>Rolling:</b> Always roll for a credit!';$('aiMessages').innerHTML+=`<div class="ai-msg bot">${r}</div>`;$('aiMessages').scrollTop=$('aiMessages').scrollHeight},500)}
let currentPrice=PREMIUM_PRICE;
function openPremium(){if(S.isPremium){alert('You already have Premium access!');return}currentPrice=PREMIUM_PRICE;$('premiumPrice').innerHTML='$'+PREMIUM_PRICE.toFixed(2)+'<span style="font-size:16px;font-weight:400;opacity:.7">/lifetime</span>';$('discountCode').value='';openModal('premiumModal');initPayPal()}
function applyDiscount(){const code=$('discountCode').value.trim().toUpperCase();if(!code){currentPrice=PREMIUM_PRICE;$('premiumPrice').innerHTML='$'+PREMIUM_PRICE.toFixed(2)+'<span style="font-size:16px;font-weight:400;opacity:.7">/lifetime</span>';initPayPal();return}const discount=DISCOUNT_CODES[code];if(discount){if(discount===100){S.isPremium=true;save();closeModal('premiumModal');alert('Welcome to Premium! 100% discount applied.');renderSignals();renderProfile();return}currentPrice=PREMIUM_PRICE*(1-discount/100);$('premiumPrice').innerHTML='<span style="text-decoration:line-through;opacity:.5;font-size:18px">$'+PREMIUM_PRICE.toFixed(2)+'</span> $'+currentPrice.toFixed(2)+'<span style="font-size:16px;font-weight:400;opacity:.7">/lifetime</span>';initPayPal();alert(discount+'% discount applied!')}else{alert('Invalid discount code')}}
function initPayPal(){const container=$('paypal-button-container');container.innerHTML='';if(typeof paypal==='undefined'){container.innerHTML='<p style="text-align:center;color:var(--text3);font-size:13px;padding:20px">Loading payment options...</p>';return}paypal.Buttons({style:{layout:'vertical',color:'gold',shape:'rect',label:'pay'},createOrder:(data,actions)=>actions.order.create({purchase_units:[{amount:{value:currentPrice.toFixed(2)},description:'Market Elites Premium'}]}),onApprove:(data,actions)=>actions.order.capture().then(details=>{S.isPremium=true;save();closeModal('premiumModal');alert('Payment successful! Welcome to Premium, '+details.payer.name.given_name+'!');renderSignals();renderProfile()}),onError:err=>{console.error(err);alert('Payment error. Please try again.')}}).render('#paypal-button-container')}
function toggleNotif(){if(!S.notifOn&&'Notification'in window){Notification.requestPermission().then(p=>{if(p==='granted'){S.notifOn=true;['notifSwitch','qNotifSwitch'].forEach(id=>$(id)?.classList.toggle('on',true));save()}else{alert('Please enable notifications in your browser settings')}})}else{S.notifOn=!S.notifOn;['notifSwitch','qNotifSwitch'].forEach(id=>$(id)?.classList.toggle('on',S.notifOn));save()}}
function updateStatus(){const ok=S.apiKey.length>10&&S.secretKey.length>10;$('statusPill').className='status'+(ok?' ready':'');$('statusText').textContent=ok?'Ready':'Offline'}
function renderHome(){$('balanceVal').textContent=S.accSize.toLocaleString();const prem=S.positions.reduce((s,p)=>s+(p.premium||0)*(p.contracts||1)*100,0);const pct=S.accSize>0?(prem/S.accSize*100).toFixed(1):0;$('balanceChange').textContent='‚Üë +$'+prem.toFixed(0)+' ('+pct+'%)';const init=S.user.name?S.user.name.split(' ').map(n=>n[0]).join('').toUpperCase().slice(0,2):'?';$('heroInitials').textContent=init;renderHomeUpdates();renderPositions();renderHistory()}
function renderHomeUpdates(){const c=$('homeUpdatesContainer');const section=$('updatesSection');if(!S.notifications.length){section.style.display='none';return}section.style.display='block';const recent=S.notifications.slice(0,3);c.innerHTML=recent.map(n=>{const unread=!S.readNotifs.includes(n.id);const iconBg=n.type==='signal'?'var(--green-bg)':'var(--blue-bg)';const iconColor=n.type==='signal'?'var(--green)':'var(--blue)';return`<div class="notif-item ${unread?'unread':''}" onclick="nav('signals');showSignalTab('notifs');markNotifRead('${n.id}')" style="cursor:pointer"><div class="notif-icon" style="background:${iconBg}"><svg viewBox="0 0 24 24" fill="none" style="stroke:${iconColor}">${n.type==='signal'?'<path d="M22 12h-4l-3 9L9 3l-3 9H2"/>':'<path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/>'}</svg></div><div class="notif-content"><div class="notif-title">${n.title}</div><div class="notif-text">${n.text}</div><div class="notif-time">${getTimeAgo(n.time)}</div></div></div>`}).join('')}
function renderPositions(){const c=$('positionsContainer');if(!S.positions.length){c.innerHTML='<div class="empty"><div class="empty-icon"><svg viewBox="0 0 24 24"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg></div><div class="empty-title">No Positions</div><div class="empty-text">Add positions or sync from Alpaca</div><button class="empty-btn" onclick="openAdd()">+ Add Position</button></div>';return}c.innerHTML=S.positions.map(p=>{const dte=p.expiration?Math.ceil((new Date(p.expiration)-new Date())/864e5):null;const pnl=(p.premium||0)*(p.contracts||1)*100*.4;return`<div class="pos-card" onclick="viewPos('${p.id}')"><div class="pos-top"><div class="pos-left"><div class="pos-logo"><img src="${logo(p.symbol)}" onerror="this.outerHTML='<span class=pos-logo-text>${p.symbol.slice(0,2)}</span>'"></div><div><div class="pos-symbol">${p.symbol}${p.strike?' $'+p.strike+(p.type==='csp'?'P':'C'):''}</div><div class="pos-name">${names[p.symbol]||p.symbol}</div></div></div><span class="pos-badge ${p.type}">${p.type.toUpperCase()}</span></div><div class="pos-stats"><div><div class="pos-stat-val ${pnl>=0?'pos':'neg'}">${pnl>=0?'+':''}$${Math.abs(pnl).toFixed(0)}</div><div class="pos-stat-label">P&L</div></div><div><div class="pos-stat-val">$${((p.premium||0)*(p.contracts||1)*100).toFixed(0)}</div><div class="pos-stat-label">Premium</div></div><div style="text-align:right"><div class="pos-stat-val">${dte!==null?dte:'‚Äî'}</div><div class="pos-stat-label">${dte!==null?'DTE':'Hold'}</div></div></div></div>`}).join('')}
function renderHistory(){const c=$('historyContainer');if(!S.history.length){c.innerHTML='<div style="text-align:center;padding:32px;color:var(--text2);font-size:14px;background:var(--card);border:1px solid var(--border);border-radius:16px">Closed trades appear here</div>';return}c.innerHTML='<div class="tx-list">'+S.history.slice(0,5).map(t=>`<div class="tx-item"><div class="tx-icon ${t.type}"><svg viewBox="0 0 24 24">${t.type==='csp'?'<circle cx="12" cy="12" r="10"/><path d="M12 8v8M8 12l4 4 4-4"/>':'<circle cx="12" cy="12" r="10"/><path d="M12 16V8M8 12l4-4 4 4"/>'}</svg></div><div class="tx-info"><div class="tx-title">${t.symbol} $${t.strike||''}${t.type==='csp'?'P':'C'}</div><div class="tx-sub">${new Date(t.closeDate||Date.now()).toLocaleDateString()}</div></div><div class="tx-amount ${(t.pnl||0)>=0?'pos':'neg'}">${(t.pnl||0)>=0?'+':'-'}$${Math.abs(t.pnl||0).toFixed(0)}</div></div>`).join('')+'</div>'}
function viewPos(id){const p=S.positions.find(x=>x.id===id);if(!p)return;S.selPosId=id;$('posTitle').textContent=p.symbol;$('posContent').innerHTML=`<div class="stats-grid"><div class="stat-box"><div class="stat-val">${p.type.toUpperCase()}</div><div class="stat-label">Type</div></div><div class="stat-box"><div class="stat-val">${p.contracts||1}</div><div class="stat-label">Contracts</div></div>${p.strike?`<div class="stat-box"><div class="stat-val">$${p.strike}</div><div class="stat-label">Strike</div></div>`:''}<div class="stat-box"><div class="stat-val green">$${((p.premium||0)*(p.contracts||1)*100).toFixed(0)}</div><div class="stat-label">Premium</div></div></div>`;openModal('posModal')}
function closePosition(){if(!S.selPosId)return;const p=S.positions.find(x=>x.id===S.selPosId);if(p){S.history.unshift({...p,closeDate:new Date().toISOString(),pnl:(p.premium||0)*(p.contracts||1)*100*.6});S.positions=S.positions.filter(x=>x.id!==S.selPosId);save();closeModal('posModal');renderHome()}}
async function syncPositions(){if(!S.apiKey)return alert('Add API keys in settings first');try{$('statusPill').className='status live';$('statusText').textContent='Syncing...';const r=await fetch('https://paper-api.alpaca.markets/v2/positions',{headers:{'APCA-API-KEY-ID':S.apiKey,'APCA-API-SECRET-KEY':S.secretKey}});if(!r.ok)throw new Error('Failed');const pos=await r.json();pos.forEach(p=>{if(!S.positions.find(x=>x.symbol===p.symbol)){S.positions.push({id:Date.now().toString()+Math.random(),symbol:p.symbol,type:'shares',contracts:parseInt(p.qty),costBasis:parseFloat(p.avg_entry_price),synced:true,openDate:new Date().toISOString()})}});const ar=await fetch('https://paper-api.alpaca.markets/v2/account',{headers:{'APCA-API-KEY-ID':S.apiKey,'APCA-API-SECRET-KEY':S.secretKey}});if(ar.ok){const a=await ar.json();S.accSize=parseFloat(a.equity)||S.accSize}save();$('statusPill').className='status live';$('statusText').textContent='Live';renderHome()}catch(e){$('statusPill').className='status';$('statusText').textContent='Error';alert('Sync failed')}}
function setAddMode(m){S.addMode=m;$('addCspBtn').classList.toggle('active',m==='csp');$('addCcBtn').classList.toggle('active',m==='cc');$('addSharesBtn').classList.toggle('active',m==='shares');if(m==='shares'){hide('optFields');show('shareFields')}else{show('optFields');hide('shareFields')}}
function savePosition(){const sym=$('addSymbol').value.trim().toUpperCase();if(!sym)return alert('Enter symbol');const p={id:Date.now().toString(),symbol:sym,type:S.addMode,contracts:parseInt($('addContracts').value)||1,openDate:new Date().toISOString()};if(S.addMode==='shares')p.costBasis=parseFloat($('addCost').value)||0;else{p.strike=parseFloat($('addStrike').value)||0;p.expiration=$('addExp').value;p.premium=parseFloat($('addPremium').value)||0;if(!p.strike||!p.expiration)return alert('Fill strike & expiration')}S.positions.push(p);save();closeModal('addModal');renderHome()}
function setMode(m){S.mode=m;$('cspBtn').classList.toggle('active',m==='csp');$('ccBtn').classList.toggle('active',m==='cc')}
function qSearch(s){$('tickerInput').value=s;searchTicker()}
async function searchTicker(){const t=$('tickerInput').value.trim().toUpperCase();if(!t)return;if(!S.apiKey)return alert('Add API keys first');hide('emptyCalc');show('loadingCard');try{const r=await fetch(`https://data.alpaca.markets/v2/stocks/${t}/quotes/latest`,{headers:{'APCA-API-KEY-ID':S.apiKey,'APCA-API-SECRET-KEY':S.secretKey}});if(!r.ok)throw new Error('Not found');const d=await r.json();const q=d.quote||{};const price=((q.bp||0)+(q.ap||0))/2||q.bp||q.ap||0;$('stockSymbol').textContent=t;$('stockName').textContent=names[t]||t;$('stockPrice').textContent=price.toFixed(2);hide('loadingCard');show('stockCard');$('statusPill').className='status live';$('statusText').textContent='Live'}catch(e){hide('loadingCard');show('emptyCalc');alert(e.message)}}
function renderWatch(){const c=$('watchContainer');const list=[{sym:'AAPL',price:254.50,chg:1.2},{sym:'NVDA',price:137.80,chg:2.5},{sym:'TSLA',price:421.30,chg:-0.8},{sym:'SPY',price:595.20,chg:0.4}];c.innerHTML='<div class="tx-list">'+list.map(w=>`<div class="tx-item" onclick="qSearch('${w.sym}');nav('calc')" style="cursor:pointer"><div class="tx-icon" style="background:var(--input);overflow:hidden"><img src="${logo(w.sym)}" style="width:100%;height:100%;border-radius:50%" onerror="this.outerHTML='<span style=font-size:12px;font-weight:700>${w.sym.slice(0,2)}</span>'"></div><div class="tx-info"><div class="tx-title">${w.sym}</div><div class="tx-sub">${names[w.sym]||w.sym}</div></div><div style="text-align:right"><div style="font-size:15px;font-weight:700">$${w.price.toFixed(2)}</div><div style="font-size:12px;color:${w.chg>=0?'var(--green)':'var(--red)'}">${w.chg>=0?'+':''}${w.chg}%</div></div></div>`).join('')+'</div>'}
function refreshWatch(){renderWatch()}
function renderAlerts(){const c=$('alertsContainer');const alerts=[];S.positions.forEach(p=>{if(!p.expiration)return;const dte=Math.ceil((new Date(p.expiration)-new Date())/864e5);if(dte<=7)alerts.push({...p,dte,urgent:dte<=3})});if(!alerts.length){c.innerHTML='<div class="empty"><div class="empty-icon"><svg viewBox="0 0 24 24"><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/></svg></div><div class="empty-title">No Alerts</div><div class="empty-text">Alerts appear when positions expire soon</div></div>';return}c.innerHTML=alerts.map(a=>`<div class="pos-card" style="border-left:3px solid ${a.urgent?'var(--red)':'var(--orange)'}"><div style="font-weight:600">${a.symbol} $${a.strike}${a.type==='csp'?'P':'C'}</div><div style="font-size:13px;color:var(--text2);margin-top:4px">${a.dte} days remaining</div></div>`).join('')}
function renderSignals(){const c=$('signalsContainer');if(!S.signals.length){c.innerHTML='<div class="empty"><div class="empty-icon"><svg viewBox="0 0 24 24"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg></div><div class="empty-title">No Signals Yet</div><div class="empty-text">Signals will appear here when posted</div></div>';return}c.innerHTML=S.signals.map((s,i)=>{const locked=!S.isPremium&&i>0;const timeAgo=getTimeAgo(s.time);return`<div class="signal-card ${locked?'locked':''}"><div class="signal-header"><span class="signal-type ${s.type}">${s.type.toUpperCase()}</span><span class="signal-time">${timeAgo}${S.isAdmin?`<span style="margin-left:8px"><button onclick="event.stopPropagation();deleteSignal('${s.id}')" style="background:none;border:none;color:var(--red);cursor:pointer;font-size:12px;padding:2px 6px">Delete</button></span>`:''}</span></div><div style="display:flex;align-items:center;gap:12px;margin:8px 0"><img src="${logo(s.ticker)}" style="width:36px;height:36px;border-radius:10px;background:var(--input)" onerror="this.style.display='none'"><div class="signal-ticker" style="margin:0">${s.ticker}</div></div><div class="signal-details">$${s.strike} ${s.type==='csp'?'Put':'Call'} ¬∑ Exp ${s.exp}</div><div style="display:flex;gap:16px;font-size:13px"><span>Premium: <b style="color:var(--green)">${s.prem}</b></span><span>Delta: <b>${s.delta}</b></span></div>${s.notes?`<p style="font-size:12px;color:var(--text3);margin-top:8px;font-style:italic">${s.notes}</p>`:''}${locked?`<div class="signal-lock"><svg viewBox="0 0 24 24" fill="none" stroke-width="1.5"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg><span>Unlock with Premium</span></div>`:''}</div>`}).join('')+(!S.isPremium?'<button class="btn mt-4" onclick="openPremium()">Unlock All Signals</button>':'')}
function deleteSignal(id){if(confirm('Delete this signal?')){S.signals=S.signals.filter(s=>s.id!==id);save();renderSignals()}}
function getTimeAgo(ts){const diff=Date.now()-ts;const mins=Math.floor(diff/60000);if(mins<60)return mins+'m ago';const hrs=Math.floor(mins/60);if(hrs<24)return hrs+'h ago';const days=Math.floor(hrs/24);return days+'d ago'}
function renderNotifs(){const c=$('notifsContainer');if(!S.notifications.length){c.innerHTML='<div class="empty"><div class="empty-icon"><svg viewBox="0 0 24 24"><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/></svg></div><div class="empty-title">No Updates</div><div class="empty-text">Notifications appear here</div></div>';return}c.innerHTML=S.notifications.map(n=>{const unread=!S.readNotifs.includes(n.id);const iconBg=n.type==='signal'?'var(--green-bg)':'var(--orange-bg)';const iconColor=n.type==='signal'?'var(--green)':'var(--orange)';return`<div class="notif-item ${unread?'unread':''}" style="position:relative"><div class="notif-icon" style="background:${iconBg}"><svg viewBox="0 0 24 24" fill="none" style="stroke:${iconColor}">${n.type==='signal'?'<path d="M22 12h-4l-3 9L9 3l-3 9H2"/>':'<path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/>'}</svg></div><div class="notif-content" onclick="markNotifRead('${n.id}')"><div class="notif-title">${n.title}</div><div class="notif-text">${n.text}</div><div class="notif-time">${getTimeAgo(n.time)}</div></div>${S.isAdmin?`<div style="display:flex;gap:4px;position:absolute;top:12px;right:12px"><button onclick="editNotif('${n.id}')" style="background:var(--input);border:none;border-radius:6px;padding:4px 8px;font-size:11px;cursor:pointer;color:var(--text2)">Edit</button><button onclick="deleteNotif('${n.id}')" style="background:var(--red-bg);border:none;border-radius:6px;padding:4px 8px;font-size:11px;cursor:pointer;color:var(--red)">Delete</button></div>`:''}</div>`}).join('')}
function deleteNotif(id){if(confirm('Delete this announcement?')){S.notifications=S.notifications.filter(n=>n.id!==id);save();renderNotifs();renderHomeUpdates();updateSignalBadge()}}
function editNotif(id){const n=S.notifications.find(x=>x.id===id);if(!n)return;const newText=prompt('Edit announcement:',n.text);if(newText!==null&&newText.trim()){n.text=newText.trim();save();renderNotifs();renderHomeUpdates()}}
function markNotifRead(id){if(!S.readNotifs.includes(id)){S.readNotifs.push(id);save();updateSignalBadge();renderNotifs()}}
function addNotification(type,title,text){const notif={id:'n'+Date.now(),type,title,text,time:Date.now()};S.notifications.unshift(notif);if(S.notifications.length>50)S.notifications.pop();save();updateSignalBadge();if(S.notifOn&&'Notification'in window&&Notification.permission==='granted'){new Notification(title,{body:text,icon:'/favicon.ico'})}}
function quickFill(ticker){$('sigTicker').value=ticker}
function postSignal(){if(!S.isAdmin)return alert('Admin access required');const type=$('sigType').value;const ticker=$('sigTicker').value.trim().toUpperCase();const strike=$('sigStrike').value;const exp=$('sigExp').value.trim();const prem=$('sigPrem').value.trim();const delta=$('sigDelta').value.trim();const notes=$('sigNotes').value.trim();if(!ticker||!strike||!exp||!prem||!delta){return alert('Fill all required fields')}const signal={id:'s'+Date.now(),type,ticker,strike:parseFloat(strike),exp,prem:prem.startsWith('$')?prem:'$'+prem,delta,time:Date.now(),notes};S.signals.unshift(signal);save();addNotification('signal','New Signal Posted',`${type.toUpperCase()} on ${ticker} $${strike} ${type==='csp'?'Put':'Call'}`);$('sigTicker').value='';$('sigStrike').value='';$('sigExp').value='';$('sigPrem').value='';$('sigDelta').value='';$('sigNotes').value='';renderSignals();alert('Signal posted!')}
function postAnnouncement(){if(!S.isAdmin)return alert('Admin access required');const text=$('announcementText').value.trim();if(!text)return alert('Enter announcement message');addNotification('alert','Announcement',text);$('announcementText').value='';renderNotifs();alert('Announcement sent!')}
function enableAdmin(){const code=prompt('Enter admin code:');if(code===ADMIN_CODE){S.isAdmin=true;save();show('adminPanel');show('announcementPanel');alert('Admin mode enabled!')}else if(code){alert('Invalid code')}}
function renderProfile(){$('userName').value=S.user.name||'';$('userEmail').value=S.user.email||'';$('profileName').textContent=S.user.name||'Set up your profile';$('profileEmail').textContent=S.user.email||'Tap to edit';const init=S.user.name?S.user.name.split(' ').map(n=>n[0]).join('').toUpperCase().slice(0,2):'?';$('profileInitials').textContent=init;$('apiKeyInput').value=S.apiKey;$('secretKeyInput').value=S.secretKey;$('accSizeInput').value=S.accSize;const ok=S.apiKey.length>10;$('brokerStatus').innerHTML=ok?'<div style="padding:12px;background:var(--green-bg);border-radius:12px;margin-bottom:16px;font-weight:600;color:var(--green)"><span class="live-dot"></span>Connected</div>':'<div style="padding:12px;background:var(--orange-bg);border-radius:12px;margin-bottom:16px;font-size:13px;color:var(--orange)">Not connected</div>';const wins=S.history.filter(t=>(t.pnl||0)>=0).length;const total=S.history.length;const prem=S.positions.reduce((s,p)=>s+(p.premium||0)*(p.contracts||1)*100,0)+S.history.reduce((s,t)=>s+(t.premium||0)*(t.contracts||1)*100,0);$('pTrades').textContent=total;$('pWinRate').textContent=total?Math.round(wins/total*100)+'%':'0%';$('pPremium').textContent='$'+prem.toFixed(0);if(S.isPremium){show('proBadge');hide('proCard')}$('adminBtn').textContent=S.isAdmin?'Active ‚úì':'Enable';$('adminBtn').style.background=S.isAdmin?'var(--green-bg)':'';$('adminBtn').style.color=S.isAdmin?'var(--green)':'';['notifSwitch','qNotifSwitch'].forEach(id=>$(id)?.classList.toggle('on',S.notifOn))}
function saveProfile(){const name=$('userName').value.trim();const email=$('userEmail').value.trim();const isNewEmail=email&&email!==S.user.email;S.user.name=name;S.user.email=email;save();renderProfile();if(isNewEmail&&EMAIL_WEBHOOK){submitEmail(name,email)}alert('Saved!')}
function submitEmail(name,email){fetch(EMAIL_WEBHOOK,{method:'POST',mode:'no-cors',headers:{'Content-Type':'application/json'},body:JSON.stringify({name,email,timestamp:new Date().toISOString(),source:'MarketElites'})}).catch(()=>{})}
function connectBroker(){S.apiKey=$('apiKeyInput').value.trim();S.secretKey=$('secretKeyInput').value.trim();S.accSize=parseInt($('accSizeInput').value)||25000;save();updateStatus();renderProfile();if(S.apiKey)alert('Connected!')}
load();applyTheme();updateStatus();checkLegal();renderHome();updateSignalBadge();
</script>
</body>
</html>
